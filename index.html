
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Barcelona Art Galleries Guide</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8; /* Light blue-gray background */
        }
        .gallery-card {
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            border: 1px solid #e2e8f0; /* Light border for cards */
            display: flex;
            flex-direction: column;
        }
        .gallery-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .card-title-container {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem; /* mb-2 */
        }
        .card-title-container img.favicon { /* Specific class for favicon */
            width: 32px;  /* w-8 */
            height: 32px; /* h-8 */
            margin-right: 0.75rem; /* mr-3 */
            object-fit: contain;
            background-color: #f8fafc; /* bg-slate-50 for slight contrast if icon is transparent */
            border-radius: 0.25rem; /* rounded-sm */
            padding: 2px; /* Small padding if needed */
        }
        .card-content {
            flex-grow: 1; 
            display: flex;
            flex-direction: column;
            justify-content: space-between; 
        }
        .card-buttons-container {
            display: flex;
            flex-wrap: wrap; /* Allow buttons to wrap on small screens */
            gap: 0.5rem; /* Space between buttons */
            margin-top: auto; /* Pushes button container to the bottom */
        }
        .action-button { /* Common class for website and map buttons */
            display: inline-block;
            padding: 8px 12px; 
            color: white;
            border-radius: 6px;
            text-decoration: none;
            transition: background-color 0.2s ease-in-out;
            text-align: center;
            flex-grow: 1; 
            min-width: 120px; 
        }
        .website-link {
            background-color: #3b82f6; 
        }
        .website-link:hover {
            background-color: #2563eb; 
        }
        .map-link {
            background-color: #10b981; /* Emerald-500 */
        }
        .map-link:hover {
            background-color: #059669; /* Emerald-600 */
        }
        .sticky-header {
            position: sticky;
            top: 0;
            background-color: rgba(255, 255, 255, 0.9); 
            backdrop-filter: blur(10px);
            z-index: 50;
            padding-bottom: 1rem; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .exhibition-details p {
            margin-bottom: 0.5rem; 
        }
        .exhibition-details strong {
            color: #1e40af; 
        }
        .filter-container {
            margin-bottom: 1.5rem;
            padding: 1rem;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            display: flex; 
            flex-wrap: wrap; 
            gap: 0.75rem; 
            align-items: center;
        }
        .filter-container input[type="text"], .filter-container select {
            border: 1px solid #cbd5e1;
            padding: 0.5rem 0.75rem;
            border-radius: 6px;
            flex-grow: 1; 
        }
        .filter-container label {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            color: #374151; 
            font-size: 0.875rem; 
        }
         .filter-container input[type="checkbox"] {
            width: 1rem;
            height: 1rem;
            border-radius: 0.25rem;
            border-color: #cbd5e1;
            color: #3b82f6; 
            cursor: pointer;
        }
        .filter-container input[type="checkbox"]:focus {
            ring: #3b82f6;
        }
        .metro-section { 
            margin-top: 1rem; 
            margin-bottom: 1rem; 
        }
        .metro-section-title {
            display: flex;
            align-items: center;
            gap: 0.3rem; 
            margin-bottom: 0.25rem;
        }
        .metro-icon-svg { 
            width: 20px; 
            height: 20px;
        }
        .metro-table {
            width: 100%;
            border-collapse: collapse; 
        }
        .metro-table td {
            padding-top: 0.1rem;
            padding-bottom: 0.1rem;
            vertical-align: top; 
        }
        .metro-table .station-name-cell {
            width: 33%; 
            padding-right: 0.5rem; 
            padding-left: 0.75rem;
            vertical-align: top;
        }
         .metro-table .line-pills-cell {
            display: flex;
            flex-wrap: wrap;
            gap: 0.25rem;
            align-items: center; /* Align pills vertically if they wrap */
        }

        .metro-pill {
            display: inline-flex; 
            align-items: center;
            justify-content: center;
            min-width: 28px; 
            height: 28px; 
            padding-left: 0.3rem;
            padding-right: 0.3rem;
            border-radius: 0.25rem; 
            color: white;
            font-weight: bold;
            font-size: 0.875rem; 
            line-height: 1; 
        }
        /* Metro Line Colors from User Specification */
        .metro-L1 { background-color: #E3001B; } /* Red */
        .metro-L2 { background-color: #A04E9E; } /* Purple */
        .metro-L3 { background-color: #00A550; } /* Green */
        .metro-L4 { background-color: #FFCD00; color: #231F20; } /* Yellow, dark text */
        .metro-L5 { background-color: #0078BF; } /* Blue */
        .metro-L9 { background-color: #F58220; } /* Orange (L9 Nord/Sud) */
        .metro-L10 { background-color: #80DEEA; color: #231F20;} /* Light Blue (L10 Nord/Sud), dark text */
        .metro-L11 { background-color: #A5D6A7; color: #231F20;} /* Light Green, dark text */
        
        /* Colors for other lines based on previous image if not in user's new list */
        .metro-L6 { background-color: #808080; } /* Grey (FGC) */
        .metro-L7 { background-color: #FFA500; } /* Orange (FGC) */
        .metro-L8 { background-color: #FFC0CB; color: #231F20; } /* Pink, dark text (FGC) */
        .metro-L12 { background-color: #9ACD32; color: #231F20; } /* YellowGreen, dark text (FGC) */
        .metro-R { background-color: #009FE3; }   /* Rodalies 'R' (Using a distinct blue) */
        .metro-FGC { background-color: #666666; } /* Default Gray for other FGC lines (e.g., S lines) */
        
        .metro-other-text { 
            font-size: 0.875rem; 
            color: #4b5563; 
            margin-left: 0.1rem;
            margin-right: 0.1rem;
            white-space: nowrap; 
        }
        .station-name {
            font-weight: bold; 
            color: #374151; 
        }

    </style>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-100">

    <div class="container mx-auto p-4">
        <header class="text-center py-6 sticky-header">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-800">Barcelona Art Galleries & Museums</h1>
            <p class="text-gray-600 mt-2">Your guide for visits until July 16, 2025</p>
        </header>

        <div class="filter-container">
            <input type="text" id="searchInput" placeholder="Search by name or keyword..." class="min-w-[150px]">
            <select id="typeFilter" class="min-w-[150px]">
                <option value="">All Types</option>
            </select>
            <select id="costFilter" class="min-w-[150px]">
                <option value="">All Costs</option>
                <option value="Free">Free</option>
                <option value="€5-€10">€5-€10</option>
                <option value="€10-€15">€10-€15</option>
                <option value="€15+">€15+</option>
                <option value="Likely Free">Likely Free</option>
            </select>
            <select id="dayFilter" class="min-w-[150px]">
                <option value="">Any Day</option>
                <option value="0">Sunday</option>
                <option value="1">Monday</option>
                <option value="2">Tuesday</option>
                <option value="3">Wednesday</option>
                <option value="4">Thursday</option>
                <option value="5">Friday</option>
                <option value="6">Saturday</option>
                <option value="today">Today</option>
            </select>
             <select id="metroLineFilter" class="min-w-[150px]">
                <option value="">All Metro Lines</option>
                </select>
            <label for="articketFilter">
                <input type="checkbox" id="articketFilter">
                Articket
            </label>
        </div>

        <div id="galleryGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
            </div>
    </div>

    <script>
        // Function to extract base domain for favicon service
        function getDomain(url) {
            try {
                const parsedUrl = new URL(url);
                if (parsedUrl.hostname.includes("google.com") && parsedUrl.pathname.includes("/search")) {
                    return null; 
                }
                return parsedUrl.protocol + "//" + parsedUrl.hostname;
            } catch (e) {
                return null; 
            }
        }
        
        function parseOpeningDays(hoursString) {
            const days = { Mon: false, Tue: false, Wed: false, Thu: false, Fri: false, Sat: false, Sun: false };
            const dayMap = { "Mon": "Mon", "Tue": "Tue", "Wed": "Wed", "Thu": "Thu", "Fri": "Fri", "Sat": "Sat", "Sun": "Sun" };
            const shortToDayIndex = { "Sun":0, "Mon":1, "Tue":2, "Wed":3, "Thu":4, "Fri":5, "Sat":6 };
            const dayKeysOrdered = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
            const lowerHours = hoursString.toLowerCase();

            if (lowerHours.includes("daily") || lowerHours.includes("mon-sun") || lowerHours.includes("monday to sunday")) {
                return { Mon: true, Tue: true, Wed: true, Thu: true, Fri: true, Sat: true, Sun: true };
            }
            
            const rangeMatch = lowerHours.match(/(\w{3})\s*-\s*(\w{3})/);
            if (rangeMatch) {
                const startDayStr = rangeMatch[1].charAt(0).toUpperCase() + rangeMatch[1].slice(1);
                const endDayStr = rangeMatch[2].charAt(0).toUpperCase() + rangeMatch[2].slice(1);

                if (shortToDayIndex.hasOwnProperty(startDayStr) && shortToDayIndex.hasOwnProperty(endDayStr)) {
                    let currentIdx = shortToDayIndex[startDayStr];
                    let endIdx = shortToDayIndex[endDayStr];
                    
                    let i = currentIdx;
                    while(true) {
                        days[dayKeysOrdered[i]] = true; 
                        if (i === endIdx) break;
                        i = (i + 1) % 7; 
                    }
                }
            } else { 
                 dayKeysOrdered.forEach(day => {
                    if (lowerHours.includes(day.toLowerCase()) && !lowerHours.includes("closed on " + day.toLowerCase()) && !lowerHours.includes("closed " + day.toLowerCase())) {
                        days[day] = true;
                    }
                });
            }

            dayKeysOrdered.forEach(day => {
                if (lowerHours.includes(`closed on ${day.toLowerCase()}`) || lowerHours.includes(`closed ${day.toLowerCase()}`)) {
                    days[day] = false;
                }
                if (day === "Tue" && lowerHours.includes("closed non-holiday tue")) {
                    days[day] = false; 
                }
            });
            if (lowerHours.includes("hotel common areas") || lowerHours.includes("check website")) {
                let specificDayMentioned = dayKeysOrdered.some(day => lowerHours.includes(day.toLowerCase()) && !lowerHours.includes(`closed on ${day.toLowerCase()}`));
                if (!specificDayMentioned && !rangeMatch) { 
                     return { Mon: true, Tue: true, Wed: true, Thu: true, Fri: true, Sat: true, Sun: true, uncertain: true };
                }
            }
            return days;
        }

        const galleries = [
            {
                name: "Cordova (H10 Art Gallery)", type: "Hotel with Art", broadType: "Other", exhibitions: "Integrated art collection (not formal timed exhibitions)", hours: "Hotel common areas accessible; specific venue hours", cost: "Access to common areas free; purchases if using bar/restaurant", website: "https://www.h10hotels.com/en/barcelona-hotels/h10-art-gallery", articket: false, image: `https://www.google.com/s2/favicons?sz=64&domain_url=${getDomain("https://www.h10hotels.com/en/barcelona-hotels/h10-art-gallery")}`, mapQuery: "H10 Art Gallery, Enric Granados, 62-64, 08008 Barcelona", metroInfo: "Diagonal (L3, L5), Provença (L6, L7, FGC)"
            },
            {
                name: "ProjecteSD", type: "Contemporary Art Gallery", broadType: "Contemporary Gallery", exhibitions: "Rotating exhibitions. Check website for June/July 2025 shows.", hours: "Tue-Fri: 11am-7pm; Sat: 11am-3pm", cost: "Likely Free", website: "https://projectesd.com/", articket: false, image: `https://www.google.com/s2/favicons?sz=64&domain_url=${getDomain("https://projectesd.com/")}`, mapQuery: "ProjecteSD, Passatge Mercader, 8 Baixos 1, 08008 Barcelona", metroInfo: "Diagonal (L3, L5)"
            },
            {
                name: "Bombon Projects", type: "Contemporary Art Gallery", broadType: "Contemporary Gallery", exhibitions: "Rotating exhibitions. Check website for June/July 2025 shows.", hours: "Tue-Fri: 11am-1:30pm & 4pm-8pm (Verify); Sat: 11am-2pm (Verify July)", cost: "Likely Free", website: "https://www.bombonprojects.com/", articket: false, image: `https://www.google.com/s2/favicons?sz=64&domain_url=${getDomain("https://www.bombonprojects.com/")}`, mapQuery: "Bombon Projects, Carrer de Trafalgar, 53, 08010 Barcelona", metroInfo: "Urquinaona (L1, L4)"
            },
            {
                name: "Terranova", type: "Art Bookstore (may host events)", broadType: "Other", exhibitions: "Bookstore collection. Check for any specific events/small shows.", hours: "Wed-Sat: 11am-8pm; Sun: 11am-2pm", cost: "Free to enter bookstore", website: "https://www.google.com/search?q=Terranova+Bookstore+Barcelona", articket: false, image: "https://placehold.co/400x300/F3E5F5/CE93D8?text=Terranova", mapQuery: "Terranova Bookstore Barcelona", metroInfo: "Universitat (L1, L2) or Liceu (L3)"
            },
            {
                name: "Can Framis Museum (Fundació Vila Casas)", type: "Museum (Contemporary Catalan Art)", broadType: "Museum", exhibitions: `Permanent Collection; Temp: <strong>"Una nova porta a l'art"</strong> (May - Nov 2025)`, hours: "Tue-Sat: 11am-6pm; Sun: 11am-2pm", cost: "€8-€10 (Reduced €4-€5)", website: "https://www.fundaciovilacasas.com/en/museum/can-framis-museum-barcelona", articket: false, image: `https://www.google.com/s2/favicons?sz=64&domain_url=${getDomain("https://www.fundaciovilacasas.com/en/museum/can-framis-museum-barcelona")}`, mapQuery: "Can Framis Museum, Carrer de Roc Boronat, 116-126, 08018 Barcelona", metroInfo: "Glòries (L1), Llacuna (L4)"
            },
            {
                name: "Espais Volart (Fundació Vila Casas)", type: "Contemporary Art Space", broadType: "Contemporary Gallery", exhibitions: `<strong>"Lluís Hortalà. A poke in the eye"</strong> (until July 13, 2025)`, hours: "Tue-Sat: 11am-2pm & 4:30pm-8pm; Sun: 11am-2pm", cost: "€5-€10 (Check combined tickets with Fundació)", website: "https://www.fundaciovilacasas.com/en/spaces/espais-volart-barcelona", articket: false, image: `https://www.google.com/s2/favicons?sz=64&domain_url=${getDomain("https://www.fundaciovilacasas.com/en/spaces/espais-volart-barcelona")}`, mapQuery: "Espais Volart, Carrer d'Ausiàs Marc, 22, 08010 Barcelona", metroInfo: "Urquinaona (L1, L4), Arc de Triomf (L1)"
            },
            {
                name: "Museu de l'Art Prohibit", type: "Museum (Forbidden Art)", broadType: "Museum", exhibitions: "Collection of ~200 censored/banned artworks", hours: "Mon-Sun: 10am-7pm (Closed non-holiday Tue)", cost: "€12 (Online), €14 (Box Office). Reduced available. Under 13 free.", website: "https://www.museuartprohibit.org/en", articket: false, image: `https://www.google.com/s2/favicons?sz=64&domain_url=${getDomain("https://www.museuartprohibit.org/en")}`, mapQuery: "Museu de l'Art Prohibit, Carrer Diputació, 250, 08007 Barcelona", metroInfo: "Passeig de Gràcia (L2, L3, L4)"
            },
            {
                name: "Palau de la Virreina (Centre Imatge)", type: "Photography & Visual Arts Centre", broadType: "Cultural Centre", exhibitions: `<strong>"Sara Gómez. My Contribution"</strong> (until Sep 28, 2025)`, hours: "Tue-Sun & holidays: 11am-8pm", cost: "Free", website: "https://ajuntament.barcelona.cat/lavirreina/en", articket: false, image: `https://www.google.com/s2/favicons?sz=64&domain_url=${getDomain("https://ajuntament.barcelona.cat/lavirreina/en")}`, mapQuery: "Palau de la Virreina, La Rambla, 99, 08002 Barcelona", metroInfo: "Liceu (L3)"
            },
            {
                name: "Arts Santa Mònica", type: "Contemporary Art & Culture Centre", broadType: "Cultural Centre", exhibitions: `Main program: <strong>"CITISSIMUM ALTISSIMUM FORTISSIMUM"</strong> (Check end date).<br>Events: "Sons of God/Sons of Science" (Jul 15); "Nation, race and sports" (Jul 16)`, hours: "Tue-Sun & holidays: 11am-8:30pm", cost: "Free", website: "https://www.santamonica.cat/en/", articket: false, image: `https://www.google.com/s2/favicons?sz=64&domain_url=${getDomain("https://www.santamonica.cat/en/")}`, mapQuery: "Arts Santa Mònica, La Rambla, 7, 08002 Barcelona", metroInfo: "Drassanes (L3)"
            },
            {
                name: "Fundación MAPFRE (KBr Photo Center)", type: "Photography Museum", broadType: "Museum", exhibitions: `<strong>"Joan Andreu Puig Farran. A Decade of Turmoil (1929-1939)"</strong> (June 12 - Aug 31, 2025)`, hours: "Tue-Sun (Apr-Sep): 11am-8pm. Closed Mon.", cost: "€5 (Reduced €3). Free Mon 2pm-8pm (Verify for KBr - but it says closed Mon)", website: "https://www.fundacionmapfre.org/en/art-and-culture/exhibitions/kbr-photography-center/", articket: false, image: `https://www.google.com/s2/favicons?sz=64&domain_url=${getDomain("https://www.fundacionmapfre.org/en/art-and-culture/exhibitions/kbr-photography-center/")}`, mapQuery: "KBr Barcelona Photo Center, Avenida Litoral, 30, 08005 Barcelona", metroInfo: "Ciutadella | Vila Olímpica (L4)"
            },
            {
                name: "Palau Robert", type: "Exhibition Centre (Catalan Culture)", broadType: "Cultural Centre", exhibitions: "Rotating exhibitions. Check website for specific shows in June/July 2025. (Potential concerts 1st three Thu in July).", hours: "Mon-Sat: 10am-8pm; Sun & holidays: 10am-2:30pm", cost: "Free", website: "https://palaurobert.gencat.cat/en/", articket: false, image: `https://www.google.com/s2/favicons?sz=64&domain_url=${getDomain("https://palaurobert.gencat.cat/en/")}`, mapQuery: "Palau Robert, Passeig de Gràcia, 107, 08008 Barcelona", metroInfo: "Diagonal (L3, L5)"
            },
            {
                name: "Picasso Museum", type: "Art Museum (Picasso's early years)", broadType: "Museum", exhibitions: `Permanent Collection; Temp: <strong>"The Landscapes of Picasso"</strong> (May 20 - Sep 14, 2025)`, hours: "Tue-Sun: 10am-7pm (Verify, summer may be longer)", cost: "€12-€15. Free: Thu afternoons (book well ahead!), 1st Sun/month (book!).", website: "https://www.museopicassobcn.cat/en", articket: true, image: `https://www.google.com/s2/favicons?sz=64&domain_url=${getDomain("https://www.museopicassobcn.cat/en")}`, mapQuery: "Picasso Museum Barcelona, Carrer de Montcada, 15-23, 08003 Barcelona", metroInfo: "Jaume I (L4)"
            },
            {
                name: "Museu Marítim de Barcelona", type: "Maritime Museum", broadType: "Museum", exhibitions: "Permanent Collection (Shipyards, replicas); Check website for temporary exhibitions.", hours: "Mon-Sun: 10am-8pm", cost: "€10 (Reduced €5). Under 17 free. Free Sun after 3pm.", website: "https://www.mmb.cat/en", articket: false, image: `https://www.google.com/s2/favicons?sz=64&domain_url=${getDomain("https://www.mmb.cat/en")}`, mapQuery: "Museu Marítim de Barcelona, Avinguda de les Drassanes s/n, 08001 Barcelona", metroInfo: "Drassanes (L3)"
            },
            {
                name: "CaixaForum Barcelona", type: "Cultural Centre", broadType: "Cultural Centre", exhibitions: `<strong>"Horizon and limit. Visions of the landscape"</strong> (until June 29, 2025).<br>"Symphony" VR (ongoing, separate ticket).`, hours: "Mon-Sun: 10am-8pm", cost: `Exhibitions ~€6. "Symphony" ~€12-€15.`, website: "https://caixaforum.org/es/barcelona", articket: false, image: `https://www.google.com/s2/favicons?sz=64&domain_url=${getDomain("https://caixaforum.org/es/barcelona")}`, mapQuery: "CaixaForum Barcelona, Av. Francesc Ferrer i Guàrdia, 6-8, 08038 Barcelona", metroInfo: "Espanya (L1, L3, L8, FGC) + walk/bus"
            },
            {
                name: "CCCB (Centre Cultura Contemporània)", type: "Contemporary Culture Centre", broadType: "Cultural Centre", exhibitions: `<strong>"The Great Addiction. From games of chance to ludopathy"</strong> (May 16 - Nov 2, 2025).<br>"Mirador" viewpoint.`, hours: "Tue-Sun & holidays: 11am-8pm", cost: "~€6-€9 per exhibition. Free Sun 3pm-8pm (book ahead).", website: "https://www.cccb.org/en", articket: true, image: `https://www.google.com/s2/favicons?sz=64&domain_url=${getDomain("https://www.cccb.org/en")}`, mapQuery: "CCCB, Carrer de Montalegre, 5, 08001 Barcelona", metroInfo: "Universitat (L1, L2), Catalunya (L1, L3)"
            },
            {
                name: "MACBA (Contemporary Art Museum)", type: "Contemporary Art Museum", broadType: "Museum", exhibitions: `Collection; Temp: <strong>"Daniel Steegmann Mangrané"</strong> (Mar 21 - Sep 7, 2025);<br><strong>"Laura Lima. Alfaiataria"</strong> (June 13 - Oct 12, 2025)`, hours: "Weekdays (verify Mon): 11am-7:30pm; Sat: 10am-8pm; Sun & holidays: 10am-3pm", cost: "~€12. Free Sat 4pm-8pm, 1st Sun/month (book ahead).", website: "https://www.macba.cat/en", articket: true, image: `https://www.google.com/s2/favicons?sz=64&domain_url=${getDomain("https://www.macba.cat/en")}`, mapQuery: "MACBA, Plaça dels Àngels, 1, 08001 Barcelona", metroInfo: "Universitat (L1, L2), Catalunya (L1, L3)"
            },
            {
                name: "Design Museum of Barcelona", type: "Design Museum", broadType: "Museum", exhibitions: `Permanent Collections; Temp: <strong>"Printed matter. Two centuries of graphic design collections at the Museu del Disseny"</strong> (Mar 27 - Sep 28, 2025)`, hours: "Tue-Sun: 10am-8pm", cost: "~€6. Free Sun 3pm-8pm, 1st Sun/month all day.", website: "https://ajuntament.barcelona.cat/museudeldisseny/en", articket: true, image: `https://www.google.com/s2/favicons?sz=64&domain_url=${getDomain("https://ajuntament.barcelona.cat/museudeldisseny/en")}`, mapQuery: "Design Museum of Barcelona, Plaça de les Glòries Catalanes, 37-38, 08018 Barcelona", metroInfo: "Glòries (L1)"
            },
            {
                name: "Galeria Valid Foto BCN", type: "Photography Gallery", broadType: "Contemporary Gallery", exhibitions: "Rotating exhibitions. Check website for specific shows in June/July 2025.", hours: "Tue-Fri (am/pm slots); Sat (am) - Verify specific hours", cost: "Likely Free", website: "https://validfoto.com", articket: false, image: `https://www.google.com/s2/favicons?sz=64&domain_url=${getDomain("https://validfoto.com")}`, mapQuery: "Galeria Valid Foto BCN, Carrer de Buenaventura Muñoz, 6, 08018 Barcelona", metroInfo: "Arc de Triomf (L1, Rodalies)"
            },
            {
                name: "Casa Vicens Gaudí", type: "Architectural Site (Gaudí)", broadType: "Architectural Site", exhibitions: "The house itself is the exhibit.", hours: "Daily: ~10am-8pm (Summer hours - Verify)", cost: "~€18-€21 (Book online, timed entry)", website: "https://casavicens.org/en/", articket: false, image: `https://www.google.com/s2/favicons?sz=64&domain_url=${getDomain("https://casavicens.org/en/")}`, mapQuery: "Casa Vicens Gaudí, Carrer de les Carolines, 20-26, 08012 Barcelona", metroInfo: "Fontana (L3), Lesseps (L3)"
            },
            {
                name: "Casa Amatller", type: "Architectural Site (Modernist)", broadType: "Architectural Site", exhibitions: "Historic house museum (guided/video tours).", hours: "Daily tours, book specific slots (~10am-6pm)", cost: "Tours ~€17-€24 (Book online)", website: "https://casaamatller.com/en/", articket: false, image: `https://www.google.com/s2/favicons?sz=64&domain_url=${getDomain("https://casaamatller.com/en/")}`, mapQuery: "Casa Amatller, Passeig de Gràcia, 41, 08007 Barcelona", metroInfo: "Passeig de Gràcia (L2, L3, L4)"
            },
            {
                name: "Mies van der Rohe Pavilion", type: "Architectural Site (Modernist)", broadType: "Architectural Site", exhibitions: "The Pavilion itself. Check for temporary artistic interventions.", hours: "Daily: 10am-8pm (Summer hours)", cost: "~€8-€10", website: "https://miesbcn.com/the-pavilion/", articket: false, image: `https://www.google.com/s2/favicons?sz=64&domain_url=${getDomain("https://miesbcn.com/the-pavilion/")}`, mapQuery: "Mies van der Rohe Pavilion, Av. Francesc Ferrer i Guàrdia, 7, 08038 Barcelona", metroInfo: "Espanya (L1, L3, L8, FGC)"
            },
            {
                name: "Canòdrom - Ateneu d'Innovació", type: "Digital Innovation Centre", broadType: "Other", exhibitions: "Program varies (events, workshops, installations). Check website agenda for June/July 2025.", hours: "Building Mon-Fri (Verify for public access/events)", cost: "Many events free; check specific program.", website: "https://canodrom.barcelona/", articket: false, image: `https://www.google.com/s2/favicons?sz=64&domain_url=${getDomain("https://canodrom.barcelona/")}`, mapQuery: "Canòdrom, Carrer de Concepció Arenal, 165, 08027 Barcelona", metroInfo: "Fabra i Puig (L1), Virrei Amat (L5)"
            },
            {
                name: "Fundació Joan Miró", type: "Major Art Museum (Miró & Contemporary)", broadType: "Museum", exhibitions: `Permanent Collection; <strong>"Paula García-Masedo: To See After Nature"</strong> (until June 29, 2025). Check for other temp. exhibitions.`, hours: "Tue-Sat: 10am-7pm (Apr-Oct); Sun: 10am-3pm", cost: "~€14-€15", website: "https://www.fmirobcn.org/en/", articket: true, image: `https://www.google.com/s2/favicons?sz=64&domain_url=${getDomain("https://www.fmirobcn.org/en/")}`, mapQuery: "Fundació Joan Miró, Parc de Montjuïc, s/n, 08038 Barcelona", metroInfo: "Espanya (L1,L3) then Funicular/Bus 150"
            },
            {
                name: "MNAC (Museu Nacional d'Art de Catalunya)", type: "National Art Museum", broadType: "Museum", exhibitions: `Permanent Collections; <strong>"Zurbarán (sobre) Natural"</strong> (until June 29, 2025). Check for other temp. exhibitions.`, hours: "Tue-Sat: 10am-8pm (May-Sep); Sun & holidays: 10am-3pm", cost: "~€12. Free Sat from 3pm, 1st Sun/month.", website: "https://www.museunacional.cat/en", articket: true, image: `https://www.google.com/s2/favicons?sz=64&domain_url=${getDomain("https://www.museunacional.cat/en")}`, mapQuery: "MNAC, Palau Nacional, Parc de Montjuïc, s/n, 08038 Barcelona", metroInfo: "Espanya (L1, L3, L8, FGC) + walk/bus"
            },
            {
                name: "Fundació Antoni Tàpies", type: "Art Museum/Foundation (Tàpies & Contemp.)", broadType: "Museum", exhibitions: `Works by Tàpies; <strong>"Marta Palau"</strong> (until Jul 6);<br><strong>"Noor Abed"</strong> (until Jul 27);<br><strong>"Anna Malagrida"</strong> (until Sep 28);<br><strong>"Antoni Tàpies"</strong> (until Jan 2026)`, hours: "Tue-Sun: 10am-7pm", cost: "~€8-€10", website: "https://fundaciotapies.org/en/", articket: true, image: `https://www.google.com/s2/favicons?sz=64&domain_url=${getDomain("https://fundaciotapies.org/en/")}`, mapQuery: "Fundació Antoni Tàpies, Carrer d'Aragó, 255, 08007 Barcelona", metroInfo: "Passeig de Gràcia (L2, L3, L4)"
            },
            {
                name: "MEAM (Museu Europeu d'Art Modern)", type: "Museum (Contemporary Figurative Art)", broadType: "Museum", exhibitions: `Permanent Collection; <strong>"Dreams and temptations. Sculpture in Catalonia in the Time of Modernism"</strong> (June 6 - Sep 28, 2025)`, hours: "Tue-Sun: 11am-7pm", cost: "~€11-€15", website: "https://www.meam.es/en/", articket: false, image: `https://www.google.com/s2/favicons?sz=64&domain_url=${getDomain("https://www.meam.es/en/")}`, mapQuery: "MEAM, Carrer de la Barra de Ferro, 5, 08003 Barcelona", metroInfo: "Jaume I (L4)"
            },
            {
                name: "Foto Colectania", type: "Photography Centre/Foundation", broadType: "Contemporary Gallery", exhibitions: "Rotating exhibitions. Check website for specific shows in June/July 2025.", hours: "Tue-Sat: 11am-8pm; Sun: 11am-3pm", cost: "~€4-€6. Check for free times.", website: "https://www.fotocolectania.org/en/", articket: false, image: `https://www.google.com/s2/favicons?sz=64&domain_url=${getDomain("https://www.fotocolectania.org/en/")}`, mapQuery: "Foto Colectania, Passeig de Picasso, 14, 08003 Barcelona", metroInfo: "Arc de Triomf (L1), Barceloneta (L4)"
            },
            {
                name: "ADN Galeria", type: "Contemporary Art Gallery", broadType: "Contemporary Gallery", exhibitions: `<strong>"2005—2025: Joaquin Díez-Cascón & ADN Galeria"</strong> (May 8 - Aug 23);<br><strong>"Connexions..."</strong> (Marina Vargas) (May 8 - Aug 23);<br><strong>"Y lo peor..."</strong> (Carlos Pazos) (June 12 - Aug 23)`, hours: "Check website", cost: "Likely Free", website: "https://adngaleria.com/exhibitions/", articket: false, image: `https://www.google.com/s2/favicons?sz=64&domain_url=${getDomain("https://adngaleria.com/exhibitions/")}`, mapQuery: "ADN Galeria, C/ de Mallorca, 205, 08036 Barcelona", metroInfo: "Hospital Clínic (L5), Diagonal (L3,L5)"
            },
            {
                name: "Galeria Senda", type: "Contemporary Art Gallery", broadType: "Contemporary Gallery", exhibitions: `<strong>"BOOM. Miralda"</strong> (May 6 - July 30, 2025)`, hours: "Check website", cost: "Likely Free", website: "https://www.galeriasenda.com/", articket: false, image: `https://www.google.com/s2/favicons?sz=64&domain_url=${getDomain("https://www.galeriasenda.com/")}`, mapQuery: "Galeria Senda, C/ de Trafalgar, 32, 08010 Barcelona", metroInfo: "Urquinaona (L1, L4)"
            },
            {
                name: "Sala Parés", type: "Art Gallery (Contemporary & Traditional)", broadType: "Contemporary Gallery", exhibitions: `<strong>"Un encuentro. Leticia Feduchi"</strong> (until June 28);<br><strong>"Joan Brossa. Poemes visuals..."</strong> (until July 6, 2025)`, hours: "Check website", cost: "Likely Free", website: "https://www.salapares.com/", articket: false, image: `https://www.google.com/s2/favicons?sz=64&domain_url=${getDomain("https://www.salapares.com/")}`, mapQuery: "Sala Parés, C/ de Petritxol, 5, 08002 Barcelona", metroInfo: "Liceu (L3)"
            },
            {
                name: "3 Punts Galeria", type: "Contemporary Art Gallery", broadType: "Contemporary Gallery", exhibitions: `<strong>"Un cuadro y siete esculturas. Okuda San Miguel"</strong> (June 11 - July 19, 2025)`, hours: "Check website", cost: "Likely Free", website: "https://www.3punts.com/", articket: false, image: `https://www.google.com/s2/favicons?sz=64&domain_url=${getDomain("https://www.3punts.com/")}`, mapQuery: "3 Punts Galeria, C/ d'Enric Granados, 21, 08007 Barcelona", metroInfo: "Passeig de Gràcia (L2, L3, L4)"
            },
            {
                name: "Moco Museum Barcelona", type: "Modern & Contemporary Art Museum", broadType: "Museum", exhibitions: `Works by Banksy, Warhol, etc.; Digital Art. Check "Ongoing" shows. <strong>"ROBIN KID"</strong> may have just ended/be ending.`, hours: "Mon-Sun: 10am-8/9pm (Verify)", cost: "~€17.50 - €22.95 (Dynamic pricing, book online)", website: "https://mocomuseum.com/locations/barcelona", articket: false, image: `https://www.google.com/s2/favicons?sz=64&domain_url=${getDomain("https://mocomuseum.com/locations/barcelona")}`, mapQuery: "Moco Museum Barcelona, Carrer de Montcada, 25, 08003 Barcelona", metroInfo: "Jaume I (L4)"
            }
        ].map(gallery => ({ ...gallery, openingDays: parseOpeningDays(gallery.hours) }));


        const galleryGrid = document.getElementById('galleryGrid');
        const searchInput = document.getElementById('searchInput');
        const typeFilter = document.getElementById('typeFilter');
        const costFilter = document.getElementById('costFilter');
        const articketFilter = document.getElementById('articketFilter');
        const dayFilter = document.getElementById('dayFilter');
        const metroLineFilter = document.getElementById('metroLineFilter');


        function populateTypeFilter() {
            const broadTypes = new Set(galleries.map(g => g.broadType));
            broadTypes.forEach(broadType => {
                if (broadType) { 
                    const option = document.createElement('option');
                    option.value = broadType;
                    option.textContent = broadType;
                    typeFilter.appendChild(option);
                }
            });
        }
        
        function populateMetroLineFilter() {
            const lines = new Set();
            galleries.forEach(gallery => {
                if (gallery.metroInfo && gallery.metroInfo.toLowerCase() !== 'n/a') {
                    const lineMatches = gallery.metroInfo.match(/(L\d{1,2}|FGC|Rodalies)/gi);
                    if (lineMatches) {
                        lineMatches.forEach(line => lines.add(line.toUpperCase()));
                    }
                }
            });
            
            // Metro line endpoints mapping
            const lineEndpoints = {
                'L1': 'Hospital de Bellvitge : Fondo',
                'L2': 'Paral·lel : Badalona Pompeu Fabra',
                'L3': 'Zona Universitària : Trinitat Nova',
                'L4': 'La Pau : Trinitat Nova',
                'L5': 'Cornellà Centre : Vall d\'Hebron',
                'L6': 'Plaça Catalunya : Sarrià (FGC)',
                'L7': 'Plaça Catalunya : Av. Tibidabo (FGC)',
                'L8': 'Plaça Espanya : Molí Nou-Ciutat Cooperativa (FGC)',
                'L9': 'La Sagrera : Aeroport T1 / Can Zam',
                'L10': 'La Sagrera : Gorg / ZAL',
                'L11': 'Trinitat Nova : Can Cuiàs',
                'L12': 'Sarrià : Reina Elisenda (FGC)',
                'FGC': 'Various suburban lines',
                'RODALIES': 'Regional train network'
            };
            
            const sortedLines = Array.from(lines).sort((a, b) => {
                const aIsL = a.startsWith('L');
                const bIsL = b.startsWith('L');
                if (aIsL && bIsL) {
                    return parseInt(a.substring(1)) - parseInt(b.substring(1));
                } else if (aIsL) {
                    return -1;
                } else if (bIsL) {
                    return 1;
                } else { // Sort FGC, Rodalies alphabetically after L lines
                    if (a === 'FGC' && b === 'RODALIES') return -1;
                    if (a === 'RODALIES' && b === 'FGC') return 1;
                    return a.localeCompare(b); 
                }
            });
            
            sortedLines.forEach(line => {
                const option = document.createElement('option');
                option.value = line;
                
                const endpoints = lineEndpoints[line] || 'Check TMB website';
                option.textContent = `${line} ${endpoints}`;
                metroLineFilter.appendChild(option);
            });
        }


        function formatMetroInfo(metroInfoString) {
            if (!metroInfoString || metroInfoString.toLowerCase() === 'n/a') {
                return '<span class="metro-other-text">N/A</span>';
            }

            let tableHtml = '<table class="metro-table">';
            
            // Split by comma, "or", "then", or "+" but not if inside parentheses
            const stationEntries = [];
            let current = '';
            let parenDepth = 0;
            let i = 0;
            
            while (i < metroInfoString.length) {
                const char = metroInfoString[i];
                
                if (char === '(') {
                    parenDepth++;
                    current += char;
                } else if (char === ')') {
                    parenDepth--;
                    current += char;
                } else if (parenDepth === 0 && /[,]/.test(char)) {
                    // Check if this is followed by " or ", " then ", or " + "
                    const remaining = metroInfoString.slice(i);
                    if (remaining.match(/^,\s*(or|then|\+)/i)) {
                        // This is a separator
                        if (current.trim()) {
                            stationEntries.push(current.trim());
                        }
                        current = '';
                        // Skip past the separator
                        const match = remaining.match(/^,\s*(or|then|\+)\s*/i);
                        if (match) {
                            i += match[0].length;
                            continue;
                        }
                    } else {
                        // Regular comma separator
                        if (current.trim()) {
                            stationEntries.push(current.trim());
                        }
                        current = '';
                        i++;
                        // Skip whitespace
                        while (i < metroInfoString.length && /\s/.test(metroInfoString[i])) {
                            i++;
                        }
                        continue;
                    }
                } else {
                    current += char;
                }
                i++;
            }
            
            // Add the last entry
            if (current.trim()) {
                stationEntries.push(current.trim());
            }

            stationEntries.forEach((entry) => {
                entry = entry.trim();
                if (!entry) return;

                let stationName = '';
                let linesHtml = '';
                
                // Look for pattern "Station Name (Lines)" 
                const match = entry.match(/^(.+?)\s*\(([^)]+)\)\s*(.*)$/);
                
                if (match) {
                    // Has parentheses with lines
                    stationName = match[1].trim();
                    const linesInParens = match[2];
                    const extraText = match[3] ? match[3].trim() : '';
                    
                    // Process lines from parentheses - split by comma or space
                    const lines = linesInParens.split(/[,\s]+/).filter(Boolean);
                    lines.forEach(line => {
                        line = line.trim().toUpperCase();
                        if (line.match(/^L\d{1,2}$/)) {
                            linesHtml += `<span class="metro-pill metro-${line}">${line}</span>`;
                        } else if (line === 'FGC') {
                            linesHtml += `<span class="metro-pill metro-FGC">FGC</span>`;
                        } else if (line === 'RODALIES') {
                            linesHtml += `<span class="metro-pill metro-R">R</span>`;
                        }
                    });
                    
                    // Handle extra text like "+ walk", "+ bus"
                    if (extraText) {
                        const extraWords = extraText.split(/\s+/);
                        extraWords.forEach(word => {
                            const cleanWord = word.replace(/^\+\s*/, '').toLowerCase();
                            if (cleanWord.includes('walk') || 
                                cleanWord.includes('bus') || 
                                cleanWord.includes('funicular')) {
                                linesHtml += `<span class="metro-other-text">${cleanWord}</span>`;
                            }
                        });
                    }
                } else {
                    // No parentheses - check if it's just metro lines or station name
                    const words = entry.split(/\s+/).filter(Boolean);
                    let hasMetroLines = false;
                    let stationWords = [];
                    
                    words.forEach(word => {
                        const upperWord = word.trim().toUpperCase();
                        if (upperWord.match(/^L\d{1,2}$/)) {
                            linesHtml += `<span class="metro-pill metro-${upperWord}">${upperWord}</span>`;
                            hasMetroLines = true;
                        } else if (upperWord === 'FGC') {
                            linesHtml += `<span class="metro-pill metro-FGC">FGC</span>`;
                            hasMetroLines = true;
                        } else if (upperWord === 'RODALIES') {
                            linesHtml += `<span class="metro-pill metro-R">R</span>`;
                            hasMetroLines = true;
                        } else {
                            stationWords.push(word);
                        }
                    });
                    
                    // If no metro lines found, treat as station name
                    if (!hasMetroLines) {
                        stationName = entry;
                    } else if (stationWords.length > 0) {
                        // Mixed - some words are station name, some are lines
                        stationName = stationWords.join(' ');
                    }
                }
                
                // Add table row if we have station name or lines
                if (stationName || linesHtml) {
                    tableHtml += `<tr>
                                    <td class="station-name-cell">${stationName ? `<span class="station-name">${stationName}</span>` : ''}</td>
                                    <td class="line-pills-cell">${linesHtml}</td>
                                  </tr>`;
                }
            });
            
            tableHtml += '</table>';
            return tableHtml.includes('<tr>') ? tableHtml : '<span class="metro-other-text">Check website for location details</span>';
        }


        function renderGalleries(filteredGalleries) {
            galleryGrid.innerHTML = ''; 
            if (filteredGalleries.length === 0) {
                galleryGrid.innerHTML = `<p class="text-gray-600 text-center col-span-full">No galleries match your current filters.</p>`;
                return;
            }
            filteredGalleries.forEach(gallery => {
                const card = document.createElement('div');
                card.className = 'gallery-card bg-white rounded-xl shadow-lg overflow-hidden';
                
                let costHTML = gallery.cost;
                if (gallery.cost.toLowerCase().includes("free")) {
                    costHTML = gallery.cost.replace(/Free/gi, '<span class="font-semibold text-green-600">Free</span>');
                }
                
                const fallbackImageUrl = `https://placehold.co/32x32/E0E0E0/B0B0B0?text=${encodeURIComponent(gallery.name.charAt(0))}`;
                const googleMapsUrl = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(gallery.mapQuery || gallery.name + ", Barcelona")}`;
                const formattedMetroInfo = formatMetroInfo(gallery.metroInfo);


                card.innerHTML = `
                    <div class="p-6 card-content"> 
                        <div>
                            <div class="card-title-container">
                                <img src="${gallery.image}" 
                                     alt="Icon for ${gallery.name}" 
                                     class="favicon"
                                     onerror="this.onerror=null; this.src='${fallbackImageUrl}';">
                                <h2 class="text-xl font-bold text-gray-800">${gallery.name}</h2>
                            </div>
                            <p class="text-sm text-indigo-600 font-medium mb-3">${gallery.broadType}</p> 
                            <div class="text-gray-700 text-sm mb-3 exhibition-details">
                                <p class="font-semibold text-gray-600">Exhibition(s):</p>
                                <div class="pl-2 border-l-2 border-indigo-200">${gallery.exhibitions}</div>
                            </div>
                            <p class="text-gray-700 text-sm mb-1"><strong class="font-medium text-gray-600">Opening Hours:</strong> ${gallery.hours} <em class="text-xs text-gray-500">(Verify Online)</em></p>
                            <div class="text-gray-700 text-sm mb-1 metro-section">
                                <div class="metro-section-title">
                                   <svg class="metro-icon-svg" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M50 0L100 50L50 100L0 50Z" fill="#D4000E"/>
                                        <path d="M25 75L25 25L50 50L75 25L75 75L50 50L25 75Z" fill="white"/>
                                    </svg>
                                    <strong class="font-medium text-gray-600">Stations:</strong> 
                                </div>
                                <div class="metro-info-container pl-1">${formattedMetroInfo}</div>
                            </div>
                            <p class="text-gray-700 text-sm mb-4"><strong class="font-medium text-gray-600">Cost:</strong> ${costHTML}</p>
                            ${gallery.articket ? '<p class="text-sm text-blue-600 font-semibold mb-2">✓ Articket Barcelona</p>' : ''}
                        </div>
                        <div class="card-buttons-container">
                            <a href="${gallery.website}" target="_blank" rel="noopener noreferrer" class="action-button website-link">
                                Visit Website
                            </a>
                            <a href="${googleMapsUrl}" target="_blank" rel="noopener noreferrer" class="action-button map-link">
                                View on Map
                            </a>
                        </div>
                    </div>
                `;
                galleryGrid.appendChild(card);
            });
        }

        function filterAndRender() {
            const searchTerm = searchInput.value.toLowerCase();
            const selectedBroadType = typeFilter.value; 
            const selectedCostValue = costFilter.value;
            const isArticketChecked = articketFilter.checked;
            let selectedDay = dayFilter.value;
            const selectedMetroLine = metroLineFilter.value;


            if (selectedDay === "today") {
                selectedDay = new Date().getDay().toString(); 
            }


            const filtered = galleries.filter(gallery => {
                const matchesSearch = gallery.name.toLowerCase().includes(searchTerm) || 
                                      gallery.type.toLowerCase().includes(searchTerm) || 
                                      gallery.broadType.toLowerCase().includes(searchTerm) ||
                                      gallery.exhibitions.toLowerCase().includes(searchTerm) ||
                                      (gallery.metroInfo && gallery.metroInfo.toLowerCase().includes(searchTerm));
                const matchesBroadType = selectedBroadType ? gallery.broadType === selectedBroadType : true;
                
                let matchesCost;
                if (!selectedCostValue) { 
                    matchesCost = true;
                } else {
                    const costLower = gallery.cost.toLowerCase();
                    if (selectedCostValue === "Free" || selectedCostValue === "Likely Free") {
                        matchesCost = costLower.includes("free");
                    } else {
                        matchesCost = false; 
                        if (selectedCostValue === "€5-€10") {
                            const patterns = [
                                /\b(?:€|~€)(?:[5-9](?:\.\d{1,2})?|10(?:\.0{1,2})?)\b/, 
                                /€5-€10/, /€8-€10/, /~€6-€9/, /~€4-€6/ 
                            ];
                            if (patterns.some(pattern => pattern.test(gallery.cost))) { 
                                matchesCost = true;
                            }
                        } else if (selectedCostValue === "€10-€15") {
                            const patterns = [
                                /\b(?:€|~€)(?:1[0-5](?:\.\d{1,2})?)\b/, 
                                /€10-€15/, /€12-€15/, /~€11-€15/, /~€14-€15/, /~€12-€15/ 
                            ];
                             if (patterns.some(pattern => pattern.test(gallery.cost))) {
                                matchesCost = true;
                            }
                        } else if (selectedCostValue === "€15+") {
                            const patterns = [
                                /\b(?:€|~€)(?:1[5-9]|[2-9]\d+|\d{3,})(?:\.\d{1,2})?\b/, 
                                /€18-€21/, /~€17-€24/, /~€17\.50 - €22\.95/ 
                            ];
                             if (patterns.some(pattern => pattern.test(gallery.cost))) {
                                matchesCost = true;
                            }
                        }
                    }
                }

                const matchesArticket = isArticketChecked ? gallery.articket === true : true;

                let matchesDay = true;
                if (selectedDay && selectedDay !== "") {
                    const dayIndex = parseInt(selectedDay); 
                    const dayAbbr = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"][dayIndex];
                    if (gallery.openingDays && gallery.openingDays.hasOwnProperty(dayAbbr)) {
                        matchesDay = gallery.openingDays[dayAbbr];
                    } else if (gallery.openingDays && gallery.openingDays.uncertain) {
                        matchesDay = true; 
                    }
                     else {
                        matchesDay = false; 
                    }
                }

                let matchesMetroLine = true;
                if (selectedMetroLine) {
                    if (gallery.metroInfo && gallery.metroInfo.toLowerCase() !== 'n/a') {
                        const lineRegex = new RegExp(`\\b${selectedMetroLine.replace('L', 'L')}(?!\\d)`, 'i');
                        matchesMetroLine = lineRegex.test(gallery.metroInfo);
                    } else {
                        matchesMetroLine = false;
                    }
                }

                return matchesSearch && matchesBroadType && matchesCost && matchesArticket && matchesDay && matchesMetroLine;
            });
            renderGalleries(filtered);
        }

        // Initial render
        populateTypeFilter();
        populateMetroLineFilter(); 
        renderGalleries(galleries);

        // Event Listeners
        searchInput.addEventListener('input', filterAndRender);
        typeFilter.addEventListener('change', filterAndRender);
        costFilter.addEventListener('change', filterAndRender);
        articketFilter.addEventListener('change', filterAndRender);
        dayFilter.addEventListener('change', filterAndRender);
        metroLineFilter.addEventListener('change', filterAndRender);


    </script>
</body>
</html>
